<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>„Éö„ÉÉ„ÉàÂêå‰º¥OK„ÅÆÂÆø„Çí„Éû„ÉÉ„ÉóË°®Á§∫</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; display: flex; }
    h2 { padding: 1em; margin: 0; }
    #sidebar { 
      width: 300px; 
      background: #f5f5f5; 
      padding: 20px; 
      box-sizing: border-box;
      height: 100vh;
      overflow-y: auto;
    }
    #map { height: 100vh; flex: 1; }
    #gallery { 
      height: 100vh; 
      flex: 1; 
      display: none;
      overflow-y: auto;
      padding: 20px;
      box-sizing: border-box;
      background: #f9f9f9;
    }
    .view-toggle {
      display: flex;
      margin-bottom: 20px;
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .toggle-btn {
      flex: 1;
      padding: 10px;
      background: #e0e0e0;
      border: none;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }
    .toggle-btn.active {
      background: #1976d2;
      color: white;
    }
    .toggle-btn:hover:not(.active) {
      background: #d0d0d0;
    }
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .hotel-card {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .hotel-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    .hotel-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }
    .hotel-info {
      padding: 15px;
    }
    .hotel-name {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 8px;
      color: #333;
    }
    .hotel-details {
      font-size: 14px;
      color: #666;
      line-height: 1.4;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #333;
    }
    .form-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    #searchBtn {
      width: 100%;
      padding: 12px;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }
    #searchBtn:hover {
      background: #1565c0;
    }
    .title {
      font-size: 18px;
      margin-bottom: 20px;
      color: #333;
    }
    .cloud-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 1000;
      overflow: hidden;
    }
    .cloud {
      position: absolute;
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.9) 0%, 
        rgba(240, 248, 255, 0.8) 30%, 
        rgba(220, 230, 250, 0.7) 60%, 
        rgba(200, 220, 240, 0.6) 100%);
      border-radius: 50px;
      opacity: 0.6;
      animation: cloudFloat linear infinite;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    }
    .cloud:before, .cloud:after {
      content: '';
      position: absolute;
      background: inherit;
      border-radius: 50px;
    }
    .cloud1 {
      width: 120px;
      height: 40px;
      top: 15%;
      left: -150px;
      animation-duration: 45s;
    }
    .cloud1:before {
      width: 60px;
      height: 60px;
      top: -30px;
      left: 10px;
    }
    .cloud1:after {
      width: 80px;
      height: 50px;
      top: -20px;
      right: 15px;
    }
    .cloud2 {
      width: 180px;
      height: 60px;
      top: 25%;
      left: -200px;
      animation-duration: 60s;
      animation-delay: -10s;
    }
    .cloud2:before {
      width: 90px;
      height: 90px;
      top: -45px;
      left: 20px;
    }
    .cloud2:after {
      width: 70px;
      height: 70px;
      top: -35px;
      right: 20px;
    }
    .cloud3 {
      width: 150px;
      height: 50px;
      top: 40%;
      left: -180px;
      animation-duration: 50s;
      animation-delay: -25s;
    }
    .cloud3:before {
      width: 75px;
      height: 75px;
      top: -37px;
      left: 15px;
    }
    .cloud3:after {
      width: 60px;
      height: 60px;
      top: -30px;
      right: 25px;
    }
    .cloud4 {
      width: 200px;
      height: 70px;
      top: 8%;
      left: -250px;
      animation-duration: 70s;
      animation-delay: -40s;
      opacity: 0.4;
    }
    .cloud4:before {
      width: 100px;
      height: 100px;
      top: -50px;
      left: 25px;
    }
    .cloud4:after {
      width: 80px;
      height: 80px;
      top: -40px;
      right: 30px;
    }
    @keyframes cloudFloat {
      0% {
        transform: translateX(0) translateY(0);
      }
      25% {
        transform: translateX(25vw) translateY(-10px);
      }
      50% {
        transform: translateX(50vw) translateY(5px);
      }
      75% {
        transform: translateX(75vw) translateY(-5px);
      }
      100% {
        transform: translateX(calc(100vw + 300px)) translateY(0);
      }
    }
  </style>
</head>
<body>
  <!-- Èõ≤„ÅÆ„Ç≥„É≥„ÉÜ„Éä -->
  <div class="cloud-container">
    <div class="cloud cloud1"></div>
    <div class="cloud cloud2"></div>
    <div class="cloud cloud3"></div>
    <div class="cloud cloud4"></div>
  </div>
  
  <div id="sidebar">
    <div class="title">üêæ „Éö„ÉÉ„ÉàÂêå‰º¥OKÂÆøÊ§úÁ¥¢</div>
    
    <div class="view-toggle">
      <button class="toggle-btn active" onclick="switchView('map')">„Éû„ÉÉ„ÉóË°®Á§∫</button>
      <button class="toggle-btn" onclick="switchView('gallery')">ÁîªÂÉè„ÇÆ„É£„É©„É™„Éº</button>
    </div>
    
    <div class="form-group">
      <label for="checkinDate">„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥Êó•</label>
      <input type="date" id="checkinDate" value="2025-08-10">
    </div>
    
    <div class="form-group">
      <label for="checkoutDate">„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÊó•</label>
      <input type="date" id="checkoutDate" value="2025-08-11">
    </div>
    
    <div class="form-group">
      <label for="adultNum">Â§ß‰∫∫„ÅÆ‰∫∫Êï∞</label>
      <select id="adultNum" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        <option value="1">1Âêç</option>
        <option value="2" selected>2Âêç</option>
        <option value="3">3Âêç</option>
        <option value="4">4Âêç</option>
        <option value="5">5Âêç</option>
        <option value="6">6Âêç</option>
      </select>
    </div>
    
    <div class="form-group">
      <label for="priceRange">‰æ°Ê†ºÂ∏ØÔºà1Ê≥ä„ÅÇ„Åü„ÇäÔºâ</label>
      <select id="priceRange" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        <option value="">„Åô„Åπ„Å¶„ÅÆ‰æ°Ê†ºÂ∏Ø</option>
        <option value="0-5000">ÔΩû5,000ÂÜÜ</option>
        <option value="5000-10000">5,000ÂÜÜÔΩû10,000ÂÜÜ</option>
        <option value="10000-15000">10,000ÂÜÜÔΩû15,000ÂÜÜ</option>
        <option value="15000-20000">15,000ÂÜÜÔΩû20,000ÂÜÜ</option>
        <option value="20000-30000">20,000ÂÜÜÔΩû30,000ÂÜÜ</option>
        <option value="30000-">30,000ÂÜÜÔΩû</option>
      </select>
    </div>
    
    <div class="form-group">
      <label for="reviewFilter">„É¨„Éì„É•„ÉºË©ï‰æ°</label>
      <select id="reviewFilter" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        <option value="">„Åô„Åπ„Å¶„ÅÆË©ï‰æ°</option>
        <option value="4.0">‚≠ê4.0‰ª•‰∏ä</option>
        <option value="3.5">‚≠ê3.5‰ª•‰∏ä</option>
        <option value="3.0">‚≠ê3.0‰ª•‰∏ä</option>
        <option value="2.5">‚≠ê2.5‰ª•‰∏ä</option>
        <option value="2.0">‚≠ê2.0‰ª•‰∏ä</option>
      </select>
    </div>
    
    <button id="searchBtn" onclick="searchHotels()">Ê§úÁ¥¢</button>
  </div>
  
  <div id="map"></div>
  
  <div id="gallery">
    <div class="gallery-grid" id="galleryGrid"></div>
  </div>

  <script>
    const rakutenAppId = '1045565995948230424';
    const googleMapApiKey = 'AIzaSyDGUJ80YBBxM1uiBY-wSdp1Ng_iQl90MKE'; // ÂÖ¨ÈñãÊ≥®ÊÑè

    function buildRakutenUrl() {
      const checkinDate = document.getElementById('checkinDate').value;
      const checkoutDate = document.getElementById('checkoutDate').value;
      const adultNum = document.getElementById('adultNum').value;
      
      return `https://app.rakuten.co.jp/services/api/Travel/KeywordHotelSearch/20170426?format=jsonp&keyword=%E3%83%9A%E3%83%83%E3%83%88ok&applicationId=${rakutenAppId}&hits=30&checkinDate=${checkinDate}&checkoutDate=${checkoutDate}&adultNum=${adultNum}`;
    }

    let map;
    let currentHotels = [];

    // „Éì„É•„ÉºÂàá„ÇäÊõø„ÅàÊ©üËÉΩ
    function switchView(viewType) {
      const mapDiv = document.getElementById('map');
      const galleryDiv = document.getElementById('gallery');
      const toggleBtns = document.querySelectorAll('.toggle-btn');
      
      // „Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
      toggleBtns.forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      if (viewType === 'map') {
        mapDiv.style.display = 'block';
        galleryDiv.style.display = 'none';
      } else if (viewType === 'gallery') {
        mapDiv.style.display = 'none';
        galleryDiv.style.display = 'block';
        displayGallery(currentHotels);
      }
    }

    // „ÇÆ„É£„É©„É™„ÉºË°®Á§∫Ê©üËÉΩ
    function displayGallery(hotels) {
      const galleryGrid = document.getElementById('galleryGrid');
      galleryGrid.innerHTML = '';
      
      if (!hotels || hotels.length === 0) {
        galleryGrid.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1 / -1;">„Éõ„ÉÜ„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÊ§úÁ¥¢„ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>';
        return;
      }
      
      hotels.forEach(hotel => {
        const imageUrl = hotel.roomImageUrl || hotel.imageUrl;
        if (!imageUrl) return;
        
        const card = document.createElement('div');
        card.className = 'hotel-card';
        card.innerHTML = `
          <img src="${imageUrl}" alt="${hotel.name}" class="hotel-image" style="cursor: pointer;" onclick="window.open('${hotel.url}', '_blank')" onerror="this.style.display='none'">
          <div class="hotel-info">
            <div class="hotel-name">${hotel.name}</div>
            <div class="hotel-details">
              ${hotel.reviewAverage ? `‚≠ê ${hotel.reviewAverage}${hotel.reviewCount ? ` (${hotel.reviewCount}‰ª∂)` : ''}<br>` : ''}
              ${hotel.area ? `üìç ${hotel.area}<br>` : ''}
              ${hotel.minCharge ? `üí∞ ${hotel.minCharge}ÂÜÜÔΩû<br>` : ''}
              <div style="margin-top: 8px;">
                <a href="${hotel.url}" target="_blank" style="color: #1976d2; text-decoration: none;">Ë©≥Á¥∞„ÇíË¶ã„Çã ‚Üí</a>
              </div>
            </div>
          </div>
        `;
        galleryGrid.appendChild(card);
      });
    }

    // Ê•ΩÂ§©API„ÅÆÁßíÂçò‰ΩçÂ∫ßÊ®ô„ÇíÂ∫¶„Å´Â§âÊèõ„Åô„ÇãÈñ¢Êï∞
    function convertRakutenCoordinates(lat, lng) {
      // Ê•ΩÂ§©API„ÅØÁßíÂçò‰Ωç„ÅßÂ∫ßÊ®ô„ÇíËøî„ÅôÔºà1Â∫¶ = 3600ÁßíÔºâ
      const latDegrees = lat / 3600;
      const lngDegrees = lng / 3600;
      
      return {
        lat: latDegrees,
        lng: lngDegrees
      };
    }

    // ‰æ°Ê†º„Éï„Ç£„É´„Çø„É™„É≥„Ç∞Èñ¢Êï∞
    function filterByPrice(hotels) {
      const priceRange = document.getElementById('priceRange').value;
      if (!priceRange) return hotels;
      
      const [minPrice, maxPrice] = priceRange.split('-').map(p => p ? parseInt(p) : null);
      
      return hotels.filter(hotel => {
        if (!hotel.minCharge) return true; // ‰æ°Ê†ºÊÉÖÂ†±„Åå„Å™„ÅÑÂ†¥Âêà„ÅØË°®Á§∫
        
        const price = parseInt(hotel.minCharge);
        if (isNaN(price)) return true;
        
        if (minPrice && maxPrice) {
          return price >= minPrice && price <= maxPrice;
        } else if (minPrice) {
          return price >= minPrice;
        } else if (maxPrice) {
          return price <= maxPrice;
        }
        return true;
      });
    }

    // „É¨„Éì„É•„Éº„Éï„Ç£„É´„Çø„É™„É≥„Ç∞Èñ¢Êï∞
    function filterByReview(hotels) {
      const minRating = parseFloat(document.getElementById('reviewFilter').value);
      if (!minRating) return hotels;
      
      return hotels.filter(hotel => {
        if (!hotel.reviewAverage) return true; // „É¨„Éì„É•„ÉºÊÉÖÂ†±„Åå„Å™„ÅÑÂ†¥Âêà„ÅØË°®Á§∫
        
        const rating = parseFloat(hotel.reviewAverage);
        if (isNaN(rating)) return true;
        
        return rating >= minRating;
      });
    }

    function searchHotels() {
      // Êó¢Â≠ò„ÅÆ„Éû„Éº„Ç´„Éº„Çí„ÇØ„É™„Ç¢
      if (map) {
        // „Éû„Éº„Ç´„Éº„Çí„ÇØ„É™„Ç¢„Åô„ÇãÂá¶ÁêÜ„ÇíËøΩÂä†
        console.log("Ê§úÁ¥¢„ÇíÂÆüË°å„Åó„Åæ„Åô...");
        initMap();
      }
    }

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 35.681236, lng: 139.767125 },
        zoom: 12
      });

      // JSONP„Çí‰ΩøÁî®„Åó„Å¶CORSÂïèÈ°å„ÇíÂõûÈÅø
      const script = document.createElement('script');
      const callbackName = 'rakutenCallback';
      
      window[callbackName] = function(data) {
        console.log("Ê•ΩÂ§©API„É¨„Çπ„Éù„É≥„Çπ:", data);
        console.log("„Éá„Éº„ÇøÊßãÈÄ†Á¢∫Ë™ç:", typeof data, Object.keys(data));
        
        if (!data || (!data.hotels && !data.Items)) {
          console.log("„Éõ„ÉÜ„É´„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:", data);
          alert("„Éö„ÉÉ„ÉàÂêå‰º¥OK„ÅÆÂÆø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ");
          return;
        }
        
        // „Éá„Éº„ÇøÊßãÈÄ†„ÇíÁ¢∫Ë™çÔºàÊ•ΩÂ§©API„ÅØÊôÇ„ÄÖÁï∞„Å™„ÇãÊßãÈÄ†„ÇíËøî„ÅôÔºâ
        const hotels = data.hotels || data.Items;
        if (!hotels || hotels.length === 0) {
          console.log("„Éõ„ÉÜ„É´ÈÖçÂàó„ÅåÁ©∫„Åß„Åô:", hotels);
          alert("„Éö„ÉÉ„ÉàÂêå‰º¥OK„ÅÆÂÆø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ");
          return;
        }
        
        console.log("ÂèñÂæó„Åó„Åü„Éõ„ÉÜ„É´Êï∞:", hotels.length);

        // „Éõ„ÉÜ„É´ÊÉÖÂ†±„ÇíÈÖçÂàó„Å´Êï¥ÁêÜ
        const hotelList = hotels.map((entry, index) => {
          console.log(`„Éõ„ÉÜ„É´${index + 1}„ÅÆÊßãÈÄ†:`, entry);
          
          // „Éá„Éº„ÇøÊßãÈÄ†„ÇíÁ¢∫Ë™ç„Åó„Å¶ÈÅ©Âàá„Å´„Ç¢„ÇØ„Çª„Çπ
          const info = entry.hotel ? entry.hotel[0].hotelBasicInfo : entry;
          console.log(`„Éõ„ÉÜ„É´${index + 1}„ÅÆÂü∫Êú¨ÊÉÖÂ†±:`, info);
          
          if (!info) {
            console.log(`„Éõ„ÉÜ„É´${index + 1}: Âü∫Êú¨ÊÉÖÂ†±„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì`);
            return null;
          }
          
          let lat = parseFloat(info.latitude);
          let lng = parseFloat(info.longitude);
          
          console.log(`„Éõ„ÉÜ„É´${index + 1}„ÅÆÂ∫ßÊ®ô: lat=${lat}, lng=${lng}`);

          if (!lat || !lng || isNaN(lat) || isNaN(lng)) {
            console.log(`„Éõ„ÉÜ„É´${index + 1}: Â∫ßÊ®ô„ÅåÁÑ°Âäπ„Åß„Åô`);
            return null;
          }

          // Ê•ΩÂ§©Â∫ßÊ®ô„ÇíÊ≠£Ë¶èÂåñ
          const convertedCoords = convertRakutenCoordinates(lat, lng);
          console.log(`„Éõ„ÉÜ„É´${index + 1}„ÅÆÂ§âÊèõÂæåÂ∫ßÊ®ô: lat=${convertedCoords.lat}, lng=${convertedCoords.lng}`);
          
          // Â§âÊèõÂæå„ÅÆÂ∫ßÊ®ô„ÅåÊúâÂäπ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
          if (isNaN(convertedCoords.lat) || isNaN(convertedCoords.lng) || convertedCoords.lat < -90 || convertedCoords.lat > 90 || convertedCoords.lng < -180 || convertedCoords.lng > 180) {
            console.log(`„Éõ„ÉÜ„É´${index + 1}: Â§âÊèõÂæå„ÅÆÂ∫ßÊ®ô„ÅåÁÑ°Âäπ„Åß„Åô`);
            return null;
          }
          
          return {
            name: info.hotelName,
            lat: convertedCoords.lat,
            lng: convertedCoords.lng,
            url: info.hotelInformationUrl,
            imageUrl: info.hotelImageUrl || info.hotelThumbnailUrl,
            roomImageUrl: info.roomImageUrl,
            petInfo: info.hotelSpecial || '',
            area: info.hotelArea || '',
            minCharge: info.hotelMinCharge || '',
            reviewAverage: info.reviewAverage || '',
            reviewCount: info.reviewCount || ''
          };
        }).filter(hotel => hotel !== null);
        
        console.log("Âá¶ÁêÜ„Åï„Çå„Åü„Éõ„ÉÜ„É´Êï∞:", hotelList.length);

        // ‰æ°Ê†º„Éï„Ç£„É´„Çø„ÇíÈÅ©Áî®
        const priceFilteredList = filterByPrice(hotelList);
        console.log(`‰æ°Ê†º„Éï„Ç£„É´„ÇøÈÅ©Áî®Âæå„ÅÆ„Éõ„ÉÜ„É´Êï∞: ${priceFilteredList.length}`);
        
        // „É¨„Éì„É•„Éº„Éï„Ç£„É´„Çø„ÇíÈÅ©Áî®
        const filteredHotelList = filterByReview(priceFilteredList);
        console.log(`„É¨„Éì„É•„Éº„Éï„Ç£„É´„ÇøÈÅ©Áî®Âæå„ÅÆ„Éõ„ÉÜ„É´Êï∞: ${filteredHotelList.length}`);

        // „Åô„Åπ„Å¶„ÅÆ„Éõ„ÉÜ„É´„ÇíË°®Á§∫ÔºàÂà∂Èôê„Å™„ÅóÔºâ
        const limitedHotelList = filteredHotelList;
        console.log(`Ë°®Á§∫„Åô„Çã„Éõ„ÉÜ„É´Êï∞: ${limitedHotelList.length}`);
        
        // ÁèæÂú®„ÅÆ„Éõ„ÉÜ„É´„É™„Çπ„Éà„Çí‰øùÂ≠òÔºà„ÇÆ„É£„É©„É™„ÉºË°®Á§∫Áî®Ôºâ
        currentHotels = limitedHotelList;

        // „Éû„ÉÉ„Éó„ÅÆÂ¢ÉÁïå„ÇíË®àÁÆó„Åó„Å¶„Åô„Åπ„Å¶„ÅÆ„Éõ„ÉÜ„É´„ÅåË°®Á§∫„Åï„Çå„Çã„Çà„ÅÜ„Å´Ë™øÊï¥
        if (limitedHotelList.length > 0) {
          const bounds = new google.maps.LatLngBounds();
          
          limitedHotelList.forEach(hotel => {
            bounds.extend(new google.maps.LatLng(hotel.lat, hotel.lng));
          });
          
          // Â¢ÉÁïå„Å´„Éë„Éá„Ç£„É≥„Ç∞„ÇíËøΩÂä†„Åó„Å¶„Éû„ÉÉ„Éó„Çí„Éï„Ç£„ÉÉ„Éà
          map.fitBounds(bounds, {
            padding: { top: 50, right: 50, bottom: 50, left: 50 }
          });
          
          // „Ç∫„Éº„É†„É¨„Éô„É´„ÅåÈ´ò„Åè„Å™„Çä„Åô„Åé„Å™„ÅÑ„Çà„ÅÜ„Å´Âà∂Èôê
          const maxZoom = 10;
          google.maps.event.addListenerOnce(map, 'bounds_changed', function() {
            if (map.getZoom() > maxZoom) {
              map.setZoom(maxZoom);
            }
          });
        }

        // Êï¥ÁêÜ„Åï„Çå„Åü„Éõ„ÉÜ„É´ÈÖçÂàó„Åã„Çâ„Éû„Éº„Ç´„Éº„Çí‰ΩúÊàê
        limitedHotelList.forEach(hotel => {
          const marker = new google.maps.Marker({
            position: { lat: hotel.lat, lng: hotel.lng },
            map: map,
            title: hotel.name,
            icon: {
              url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36">
                  <circle cx="18" cy="18" r="17" fill="#FF6B6B" stroke="#D63384" stroke-width="2"/>
                  <g fill="#FFFFFF">
                    <ellipse cx="12" cy="12" rx="3" ry="4" transform="rotate(-30 12 12)"/>
                    <ellipse cx="24" cy="12" rx="3" ry="4" transform="rotate(30 24 12)"/>
                    <ellipse cx="18" cy="16" rx="6" ry="5"/>
                    <ellipse cx="18" cy="22" rx="4" ry="6"/>
                    <ellipse cx="18" cy="28" rx="2" ry="3"/>
                  </g>
                  <g fill="#333">
                    <circle cx="15" cy="17" r="1.5"/>
                    <circle cx="21" cy="17" r="1.5"/>
                    <ellipse cx="18" cy="20" rx="1" ry="1.5"/>
                  </g>
                </svg>
              `),
              scaledSize: new google.maps.Size(36, 36),
              anchor: new google.maps.Point(18, 36)
            }
          });

          const infoWindow = new google.maps.InfoWindow({
            content: `
              <div style="min-width:250px; max-width:300px; padding:5px;">
                ${hotel.imageUrl ? `<img src="${hotel.imageUrl}" alt="${hotel.name}" style="width:100%; height:120px; object-fit:cover; border-radius:4px; margin-bottom:8px; display:block;">` : ''}
                <strong style="font-size:14px; display:block; margin-bottom:5px;">${hotel.name}</strong>
                <div style="background:#e8f5e8; padding:4px 8px; border-radius:4px; margin-bottom:5px; font-size:12px;">
                  üêï „Éö„ÉÉ„ÉàÂêå‰º¥OK
                </div>
                ${hotel.reviewAverage ? `<div style="font-size:12px; color:#666; margin-bottom:3px;">‚≠ê ${hotel.reviewAverage}${hotel.reviewCount ? ` (${hotel.reviewCount}‰ª∂)` : ''}</div>` : ''}
                ${hotel.area ? `<div style="font-size:12px; color:#666; margin-bottom:3px;">üìç ${hotel.area}</div>` : ''}
                ${hotel.minCharge ? `<div style="font-size:12px; color:#666; margin-bottom:5px;">üí∞ ${hotel.minCharge}ÂÜÜÔΩû</div>` : ''}
                ${hotel.petInfo ? `<div style="font-size:11px; color:#555; margin-bottom:5px; background:#f0f0f0; padding:3px 6px; border-radius:3px;">${hotel.petInfo}</div>` : ''}
                <a href="${hotel.url}" target="_blank" style="color:#1976d2; text-decoration:none; font-size:13px;">Ë©≥Á¥∞„ÇíË¶ã„Çã ‚Üí</a>
              </div>`
          });

          marker.addListener("click", () => infoWindow.open(map, marker));
        });
        
        // „Çπ„ÇØ„É™„Éó„Éà„Çø„Ç∞„ÇíÂâäÈô§
        document.head.removeChild(script);
        delete window[callbackName];
      };
      
      script.src = buildRakutenUrl() + '&callback=' + callbackName;
      script.onerror = function() {
        console.error("Ê•ΩÂ§©APIÂëº„Å≥Âá∫„Åó„Ç®„É©„Éº");
        alert("Ê•ΩÂ§©API„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Ç¢„Éó„É™ID„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
      };
      
      document.head.appendChild(script);
    }

    // Google Maps API„ÅåË™≠„ÅøËæº„Åæ„Çå„ÅüÂæå„Å´initMap„ÇíÂÆüË°å
    window.onload = function() {
      if (typeof google !== 'undefined') {
        initMap();
      }
    };
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDGUJ80YBBxM1uiBY-wSdp1Ng_iQl90MKE">
  </script>
</body>
</html>